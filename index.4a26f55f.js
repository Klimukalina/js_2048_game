class t{static STATUS={IDLE:"idle",PLAYING:"playing",WIN:"win",LOSE:"lose"};constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.status=t.STATUS.IDLE,this.initialState=e,this.score=0,this.state=e.map(t=>[...t])}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=t.STATUS.PLAYING,this.state=this.initialState.map(t=>[...t]),this.addNewNumber(),this.addNewNumber()}restart(){this.status=t.STATUS.IDLE,this.state=this.initialState.map(t=>[...t]),this.score=0}addNewNumber(){let t=this.getEmptyPositions();if(0===t.length)return;let e=Math.floor(Math.random()*t.length),[s,a]=t[e];this.state[s][a]=.9>Math.random()?2:4}getEmptyPositions(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.state[e][s]&&t.push([e,s]);return t}toWin(){return this.state.some(t=>t.includes(2048))}toLose(){for(let t=0;t<this.state.length;t++)for(let e=0;e<this.state[t].length;e++)if(0===this.state[t][e]||t>0&&this.state[t][e]===this.state[t-1][e]||t<this.state.length-1&&this.state[t][e]===this.state[t+1][e]||e>0&&this.state[t][e]===this.state[t][e-1]||e<this.state[t].length-1&&this.state[t][e]===this.state[t][e+1])return!1;return!0}handleMove(e){e&&this.addNewNumber(),this.toWin()?this.status=t.STATUS.WIN:this.toLose()&&(this.status=t.STATUS.LOSE)}moveLeft(){if(this.status===t.STATUS.PLAYING){let t=this.state.length,e=!1;for(let s=0;s<t;s++){let a=[],i=Array(t).fill(!1);for(let e=0;e<t;e++)0!==this.state[s][e]&&a.push(this.state[s][e]);for(let t=0;t<a.length-1;t++)a[t]!==a[t+1]||i[t]||i[t+1]||(a[t]*=2,this.score+=a[t],a.splice(t+1,1),i[t]=!0);for(;a.length<t;)a.push(0);for(let i=0;i<t;i++)this.state[s][i]!==a[i]&&(this.state[s][i]=a[i],e=!0)}this.handleMove(e)}}moveRight(){if(this.status===t.STATUS.PLAYING){let t=this.state.length,e=!1;for(let s=0;s<t;s++){let a=[],i=Array(t).fill(!1);for(let e=0;e<t;e++)0!==this.state[s][e]&&a.push(this.state[s][e]);for(let t=a.length-1;t>0;t--)a[t]!==a[t-1]||i[t]||i[t-1]||(a[t]*=2,this.score+=a[t],a.splice(t-1,1),i[t]=!0);for(;a.length<t;)a.unshift(0);for(let i=0;i<t;i++)this.state[s][i]!==a[i]&&(this.state[s][i]=a[i],e=!0)}this.handleMove(e)}}moveUp(){if(this.getStatus()===t.STATUS.PLAYING){let t=this.state.length,e=!1;for(let s=0;s<t;s++){let a=[];for(let e=0;e<t;e++)0!==this.state[e][s]&&a.push(this.state[e][s]);for(let t=0;t<a.length-1;t++)a[t]===a[t+1]&&(a[t]*=2,this.score+=a[t],a.splice(t+1,1));for(;a.length<t;)a.push(0);for(let i=0;i<t;i++)this.state[i][s]!==a[i]&&(this.state[i][s]=a[i],e=!0)}this.handleMove(e)}}moveDown(){if(this.getStatus()===t.STATUS.PLAYING){let t=this.state.length,e=!1;for(let s=0;s<t;s++){let a=[];for(let e=0;e<t;e++)0!==this.state[e][s]&&a.push(this.state[e][s]);let i=Array(a.length).fill(!1);for(let t=a.length-1;t>0;t--)a[t]!==a[t-1]||i[t]||i[t-1]||(a[t]*=2,this.score+=a[t],a.splice(t-1,1),i[t]=!0);for(;a.length<t;)a.unshift(0);for(let i=0;i<t;i++)this.state[i][s]!==a[i]&&(this.state[i][s]=a[i],e=!0)}this.handleMove(e)}}}const e=new t,{startButton:s,gameScore:a,gameBoardRows:i,messageLose:r,messageWin:h,messageStart:o}={startButton:document.querySelector(".start"),gameScore:document.querySelector(".game-score"),gameBoardRows:document.querySelectorAll("tr"),messageLose:document.querySelector(".message-lose"),messageWin:document.querySelector(".message-win"),messageStart:document.querySelector(".message-start")},l=()=>{let t=e.getState();i.forEach((e,s)=>{for(let a of e.cells){a.textContent="",a.className="field-cell";let e=a.cellIndex,i=t[s][e];0!==i&&(a.textContent=i,a.classList.add(`${a.className}--${i}`))}})},n=()=>{r.classList.add("hidden"),h.classList.add("hidden"),o.classList.add("hidden"),"win"===e.getStatus()?h.classList.remove("hidden"):"lose"===e.getStatus()?r.classList.remove("hidden"):"idle"===e.getStatus()&&o.classList.remove("hidden")},c=()=>{a.textContent=e.getScore()};let d=!0;s.addEventListener("click",()=>{"Start"===s.textContent&&e.start(),"Restart"===s.textContent&&(e.restart(),s.textContent="Start",s.classList.remove("restart"),s.classList.add("start"),c()),l(),n(),d=!0}),document.addEventListener("keydown",t=>{if("idle"!==e.getStatus()){switch(t.key){case"ArrowLeft":e.moveLeft();break;case"ArrowRight":e.moveRight();break;case"ArrowUp":e.moveUp();break;case"ArrowDown":e.moveDown()}d&&(s.textContent="Restart",s.classList.remove("start"),s.classList.add("restart"),d=!1),n(),l(),c()}});
//# sourceMappingURL=index.4a26f55f.js.map
